!function(t,e){"function"==typeof define&&define.amd?define(["$"],e):"object"==typeof exports?module.exports=e():t.FormatNumber=e(window.Zepto||window.jQuery||$)}(this,function(t){t.fn.FormatNumber=function(a){var n=[];return t(this).each(function(){var r=t.extend({trigger:t(this)},a),i=new e;i.init(r),n.push(i)}),n};var e=function(){};return e.prototype={init:function(e){function a(e){var a=t(this).attr("data-name"),r=a.split(".")[1]||a.split(".")[0];n(e,t(this)[0],c);var i=d.getMoneyfloat(t(this).val());t("#"+r).val(i),t(this).attr("data-value",i)}function n(t,e,a){var n=e.value.length,r=i(e),d=window.event?t.keyCode:t.which,s=l(d,e.value,a);e.value=s,r+=s.length-n,o(e,r)}function r(t){for(var e in s)if(t==s[e])return!0;return!1}function i(t){var e=t,a=-1;if(void 0!=e.selectionStart)a=e.selectionStart;else{var n=document.selection.createRange();n.moveStart("character",-e.value.length),a=n.text.length}return a}function l(t,a,n){if(r(t))return a;var i=a,l=!1,o=/[^\d\.]/g;if(e.minus&&/^\-/.test(i)&&(i=i.slice(1),l=!0),i.indexOf(".")<=0)i=i.replace(o,"");else{i=i.replace(o,"");var s=parseFloat(i+"00");isNaN(s)&&(i=s),/\./.test(i)&&0==e.decimal&&(i=i.toString().replace(/\./g,""))}var c=new RegExp(n);c.exec(i)||""==i||(i="0");var u=i.split(".");i=u.length>1?(u[0].length>14?u[0].substr(0,14):u[0])+"."+u[1]:i.length>14?i.substr(0,14):i;var f=d.doFormat(i);if(l&&(f="-"+f),null!=f){var v=f.split(".");if(i.lastIndexOf(".")>=0)if(i.lastIndexOf(".")==i.length-1)i=v[0]+".";else{var g=i.length-(i.lastIndexOf(".")+1);i=v[0]+"."+(v[1]?v[1].substring(0,g):"0")}else i=v[0];return i}}function o(t,e){var a=t;if(void 0!=a.selectionStart)a.setSelectionRange(e,e);else{var n=a.createTextRange();n.move("character",e),n.select()}}var d=this;e=t.extend({trigger:'[data-type="money"]',decimal:2,minus:!1,parent:"body"},e),this.settings=e;var s={left:37,right:39,top:38,down:40,home:36,end:35,shift:16},c="([1-9]\\d*(\\.\\d{1,2})?|0(\\.\\d{1,2})?)";c=e.decimal<=0&&1==e.minus?"(^-?[1-9]\\d*$)|(^[0]$)":0==e.decimal?"(^[1-9]\\d*$)|(^[0]$)":1==e.minus?"(^-)?((([1-9]d*(\\.\\d{1,"+e.decimal+"})?)|((^[0]{1}\\.(\\d{1,"+e.decimal+"})?$))|^[0]$))":"([1-9]\\d*(\\.\\d{1,"+e.decimal+"})?|([^0]{1}(\\.\\d{1,"+e.decimal+"}))?)",parent=parent||"body",t(e.trigger,parent).each(function(e,a){var n,r;if("INPUT"==t(a)[0].tagName){if(n=t(a).val(),t(a).attr("data-name")){var i=t(a).attr("data-name"),l=i.split(".")[1]||i.split(".")[0];t(a).parent().append('<input data-rule="number" id="'+l+'" type="hidden" name="'+i+'" />'),t("#"+l).val(d.getMoneyfloat(t(a).val()))}r=d.doFormat(n),t(a).val(r),t(this).attr("data-value",d.getMoneyfloat(t(a).val()))}else n=t(a).text(),r=d.doFormat(n),t(a).attr("data-value",n).text(r)}),t(e.trigger,parent).on("keyup",function(t){a.call(this,t)}),t(e.trigger,parent).on("blur",function(t){a.call(this,t)})},getMoneyfloat:function(t){return""==t?null:parseFloat((t+"").replace(/[^\d\.-]/g,""))},doFormat:function(e){var a=this;return e?(t.isNumeric(e)&&(e=e.toString()),"string"==typeof e&&(e=e.replace(/^(\d+)((\.\d*)?)$/,function(t,e,n){return e.replace(/\d{1,3}(?=(\d{3})+$)/g,"$&,")+(n.slice(0,a.settings.decimal+1)||".00")})),e.replace(/^\./,"0.")):""}},e});